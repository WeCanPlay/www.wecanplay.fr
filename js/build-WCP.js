/*
* WeCanPlay : Library for html5 games
* http://www.wecanplay.fr/
* Version 0.3
*
* Copyright Â© WeCanPlay
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*/

(function(a,b,c){function d(){this.debug=!1,this.ctx=0,this.canvas=0,this.width=0,this.height=0}"use strict",d.prototype.setCanvas=function(a,c,d){this.canvas=b.getElementById(a),c>0&&d>0&&(this.canvas.width=c,this.canvas.height=d),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.ctx=this.canvas.getContext("2d"),this.initViewModule(),this.fire("canvasReady")},d.prototype.setMode=function(a){console.error("DEPRECATED - for log use WCP.log(true)")},d.prototype.log=function(a){typeof a=="boolean"&&(this.logEnable=a),this.logEnable&&console.log(a)},d.prototype.extend=function(a,b){console.error("DEPRECATED - see wiki template - kiss LeMulot")},window.WCP=new d})(window,document,undefined),function(a,b,c){function d(){}function e(){a.ctx.clearRect(0,0,a.width,a.height)}function f(a,b){var d=c.createElement("canvas");return d.width=a,d.height=b,d.ctx=d.getContext("2d"),d}function g(a,b){return Math.floor(Math.random()*(b-a+1))+a}"use strict",d.makeArray=function(a){return a instanceof Array||(a=[a]),a},d.inArray=function(a,b){for(var c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},d.getCanvasPos=function(){var b=a.canvas,c=0,d=0;while(b.offsetParent)c+=b.offsetTop,d+=b.offsetLeft,b=b.offsetParent;return{top:c,left:d}},d.cloneObject=function(a){var b={};for(var c in a)return a.hasOwnProperty(c)&&(b[c]=a[c]),b},d.degresToRadian=function(a){return a*Math.PI/180},a.Tools=d,a.clear=e,a.bufferCanvas=f,a.random=g}(WCP,window,document),function(a){"use strict",a.utils={},a.utils.makeArray=function(a){return typeof a.length=="undefined"&&(a=[a]),a},a.utils.merge=function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},a.utils.clone=function(b){var c=new b.__proto__.constructor;return a.utils.merge(c,b),c.prototype.clone&&c.clone(),c}}(WCP),function(a){function b(a,b,c,d){arguments.length===1&&typeof a=="object"?(this.x=a.x,this.y=a.y):arguments.length===4?(this.x=c-a,this.y=d-b):(this.x=a,this.y=b)}"use strict",b.prototype.get=function(){return{x:this.x,y:this.y}},b.prototype.norm=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},b.prototype.normalize=function(){var a=this.norm();return new b(this.x/a,this.y/a)},b.prototype.add=function(a){return new b(this.x+a.x,this.y+a.y)},b.prototype.sub=function(a){return new b(this.x-a.y,this.y-a.y)},b.prototype.mult=function(a){return new b(this.x*a,this.y*a)},b.prototype.dot=function(a){return this.x*a.x+this.y*a.y},b.prototype.cross=function(a){return this.x*a.y+this.y*a.x},b.prototype.tangent=function(){return new b(-this.y,this.x)},b.prototype.angleTo=function(a){return Math.atan2(this.cross(a)/(this.norm()*a.norm()),this.dot(a))},b.prototype.absoluteAngle=function(){return Math.atan2(this.cross(new b(1,0)),this.dot(new b(1,0)))},b.norm=function(a,b){return Math.sqrt(a*a+b*b)},b.normalize=function(a,c){var d=b.norm(a,c);return{x:a/d,y:c/d}},b.add=function(a,b,c,d){return{x:a+c,y:b+d}},b.sub=function(a,b,c,d){return{x:a-c,y:b-d}},a.Vector=b}(WCP),function(a){function b(){return Date.now()/1e3}function c(){return Date.now()}function d(a){this.timeout=a||0,this.reset()}function e(){this.timer=new d,this.timeouts=[],this.nTimeouts=0,this.intervals=[],this.nIntervals=0,this.clear(),this.reset()}function f(a){this.precision=.1,this.duration=a||5,this.size=Math.ceil(this.duration/this.precision)+1,this.filled=0,this.index=0,this.previousTime=0,this.startTime=0,this.data=new Array(this.size),this.reset()}"use strict",a.internalTime=0,d.prototype.elapsedTime=function(){return this.pauseStart>0?this.pauseStart-this.startTime-this.pauseDuration:c()-this.startTime-this.pauseDuration},d.prototype.pause=function(){this.pauseStart===0&&(this.pauseStart=c())},d.prototype.unpause=function(){this.pauseStart>0&&(this.pauseDuration+=c()-this.pauseStart,this.pauseStart=0)},d.prototype.paused=function(){return this.pauseStart>0},d.prototype.expired=function(){return this.timeout?this.elapsedTime()>this.timeout:!1},d.prototype.reset=function(){this.startTime=c(),this.pauseStart=0,this.pauseDuration=0},e.prototype.update=function(){if(this.paused())return;var a=this.timer.elapsedTime(),b,c;for(b in this.timeouts){c=this.timeouts[b];if(c[0]<a)try{c[1]()}catch(d){throw d}finally{delete this.timeouts[b],this.nTimeouts--}}for(b in this.intervals){c=this.intervals[b];if(c[0]+c[1]<a){c[0]=a;try{c[2]()}catch(d){throw d}}}},e.prototype.clear=function(){this.timeouts=[],this.intervals=[],this.nTimeouts=0,this.nIntervals=0},e.prototype.setTimeout=function(a,b){return this.timeouts.push([this.timer.elapsedTime()+a,b]),this.nTimeouts++,this.timeouts.length-1},e.prototype.setInterval=function(a,b){return this.intervals.push([this.timer.elapsedTime(),a,b]),this.nIntervals++,this.intervals.length-1},e.prototype.clearTimeout=function(a){return this.timeouts[a]?(delete this.timeouts[a],this.nTimeouts--,!0):!1},e.prototype.clearInterval=function(a){return this.intervals[a]?(delete this.intervals[a],this.nIntervals--,!0):!1},e.prototype.reset=function(){this.timer.reset()},e.prototype.pause=function(){this.timer.pause()},e.prototype.unpause=function(){this.timer.unpause()},e.prototype.paused=function(){return this.timer.paused()},f.prototype.get=function(){var a=0,b=0;for(var c=0;c<this.size&&c<this.filled;c++)c!==this.index&&this.data[c]>0&&(a+=this.data[c],b++);return b===0?0:a/b/this.precision},f.prototype.tick=function(){var b=a.time(),c=b-this.startTime,d=Math.floor(c/this.precision)%this.size;this.index!==d&&(this.data[d]=0),this.data[d]++,this.index=d,d>this.filled&&(this.filled=d)},f.prototype.reset=function(){this.index=0,this.filled=0,this.startTime=0;for(var a=0;a<this.size;a++)this.data[a]=0},a.time=b,a.millitime=c,a.Timer=d,a.TimeScheduler=e,a.TimeCounter=f}(WCP),function(a){function e(d,e,f){this.img=d,this.x=e||0,this.y=f||0,this.width=d.width,this.height=d.height,this.sliceX=0,this.sliceY=0,this.sliceWidth=this.width,this.sliceHeight=this.height,this.alpha=1,this.id=b++,this.originX=0,this.originY=0,this.originType=c,this.rotation=0,this.scaleX=1,this.scaleY=1,this.matrix=[1,0,0,1,0,0],this.symmetryX=this.symmetryY=!1,this.animationsData=new Array,this.animation=new a.Animation(this),this._zindex=100,this._parent=null}function f(a,b,c,d,f){var g=new e(a,0,0);return g.setSlice(b,c,d,f),g}"use strict";var b=1,c=0,d=1;e.prototype.clone=function(b,c){var d=new a.Sprite(this.img,b,c);for(var e in this)this.hasOwnProperty(e)&&e!=="id"&&(d[e]=this[e]);return d},e.prototype.setZIndex=function(a){a>=9999&&(a=9999),a<0&&(a=0);var b=this._zindex;this._zindex=a,this._parent&&this._parent._notifyZIndexChange(this,b,a)},e.prototype.getZIndex=function(){return this._zindex},e.prototype.setSubRect=function(a){this.sliceX=a.x,this.sliceY=a.y,this.sliceWidth=a.width,this.sliceHeight=a.height},e.prototype.setSlice=function(a,b,c,d){this.width=c,this.height=d,this.sliceX=a,this.sliceY=b,this.sliceWidth=c,this.sliceHeight=d},e.prototype.draw=function(b){b=b||a.ctx,b.save(),b.globalAlpha=this.alpha;var d,e,f=this.width,g=this.height;this.originType===c?(d=this.originX,e=this.originY):(d=f*this.originX,e=g*this.originY);var h=this.symmetryX===!0?-1:1,i=this.symmetryY===!0?-1:1;h===-1&&(d+=this.width),i===-1&&(e+=this.height),b.translate(this.x,this.y),b.rotate(this.rotation),b.scale(h,i),b.drawImage(this.img,this.sliceX,this.sliceY,this.sliceWidth,this.sliceHeight,-d,-e,f,g),b.restore()},e.prototype.move=function(a,b){this.x+=a,this.y+=b},e.prototype.position=function(a,b){this.x=a,this.y=b},e.prototype.scale=function(a,b){typeof b=="undefined"&&(b=a),this.scaleX=a,this.scaleY=b,this.width=this.sliceWidth*this.scaleX,this.height=this.sliceHeight*this.scaleY},e.prototype.symmetry=function(a,b){this.symmetryX=a,this.symmetryY=b},e.prototype.vector=function(){return new a.Vector(this.x,this.y)},e.prototype.getPos=function(){return{x:this.x,y:this.y}},e.prototype.getRect=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},e.prototype.animations=function(a){this.animationsData=a},e.prototype.setAnimation=function(a){if(typeof this.animationsData[a]=="undefined")return;this.animation.clean();for(var b in this.animationsData[a]){var c=this.animationsData[a][b];this.animation.setSlice(c.x,c.y,c.width,c.height),typeof this.animationsData.frameRate!="undefined"?this.animation.wait(this.animationsData.frameRate):typeof this.animationsData.timeRate!="undefined"&&this.animation.waitTime(this.animationsData.timeRate)}this.animation.repeat(),this.animation.start()},e.prototype.setOrigin=function(a,b){!b&&typeof a[0]!="undefined"?(this.originX=a[0],this.originY=a[1]):(this.originX=a,this.originY=b),this.originType=d},e.prototype.setOriginPos=function(a,b){this.originX=a,this.originY=b,this.originType=c},e.ORIGIN_TOPLEFT=[0,0],e.ORIGIN_TOP=[.5,0],e.ORIGIN_TOPRIGHT=[1,0],e.ORIGIN_LEFT=[0,.5],e.ORIGIN_CENTER=[.5,.5],e.ORIGIN_RIGHT=[1,.5],e.ORIGIN_BOTLEFT=[0,1],e.ORIGIN_BOT=[.5,1],e.ORIGIN_BOTRIGHT=[1,1],a.Sprite=e,a.SliceSprite=f}(WCP),function(a){function b(){this.callbacks=[]}function c(a,c){c?typeof c=="Object"?this.event=c:this.event=new b:this.event=new b,this.type=a}function d(){}"use strict",c.prototype.rename=function(a){this.type=a},c.prototype.suscribe=function(a){this.event.callbacks.push(a)},c.prototype.unsuscribe=function(a){var b=!1;for(var c in this.event.callbacks)if(this.event.callbacks[c]===a||!a)delete this.event.callbacks[c],b=!0;return b},c.prototype.fire=function(a){for(var b in this.event.callbacks)this.event.callbacks[b](a)},d.extend=function(a){a.prototype.initEvents=d.prototype.initEvents,a.prototype.listen=d.prototype.listen,a.prototype.handleEvents=d.prototype.handleEvents,a.prototype.custom=d.prototype.custom,a.prototype.getEvent=d.prototype.getEvent,a.prototype.register=d.prototype.register,a.prototype.suscribe=d.prototype.suscribe,a.prototype.unsuscribe=d.prototype.unsuscribe,a.prototype.on=d.prototype.on,a.prototype.fire=d.prototype.fire},d.extendObject=function(a){a.initEvents=d.prototype.initEvents,a.listen=d.prototype.listen,a.handleEvents=d.prototype.handleEvents,a.custom=d.prototype.custom,a.getEvent=d.prototype.getEvent,a.register=d.prototype.register,a.suscribe=d.prototype.suscribe,a.unsuscribe=d.prototype.unsuscribe,a.on=d.prototype.on,a.fire=d.prototype.fire},d.prototype.initEvents=function(){this.events||(this.events=[])},d.prototype.listen=function(b){this.initEvents();var d=b?b:a.canvas;if(!d)return;this.events.push(new c("mousemove")),this.events.push(new c("mouseover")),this.events.push(new c("mouseout")),this.events.push(new c("mousedown")),this.events.push(new c("mouseup")),this.events.push(new c("keydown")),d.addEventListener("mouseover",function(a){return function(b){a.handleEvents(b)}}(this),!1),d.addEventListener("mouseout",function(a){return function(b){a.handleEvents(b)}}(this),!1),d.addEventListener("mousemove",function(a){return function(b){a.handleEvents(b)}}(this),!1),d.addEventListener("mousedown",function(a){return function(b){a.handleEvents(b)}}(this),!1),d.addEventListener("mouseup",function(a){return function(b){a.handleEvents(b)}}(this),!1),window.onkeydown=function(a){return function(b){a.handleEvents(b)}}(this)},d.prototype.handleEvents=function(a){this.fire(a.type,a)},d.prototype.getEvent=function(a){if(typeof a=="object")return a;for(var b in this.events)if(this.events[b].type===a)return this.events[b]},d.prototype.register=function(a){a.prototype.suscribe=function(a){return function(b,c){a.on(b,c)}}(this),a.prototype.on=function(a,b){this.suscribe(a,b)},a.prototype.unsuscribe=function(a){return function(b,c){a.unsuscribe(b,c)}}(this),a.prototype.custom=function(a){return function(b){a.custom(b)}}(this)},d.prototype.custom=function(a,b){var d=this.getEvent(a);if(d&&b===!0)this.unsuscribe(a);else if(d&&!b)return;return d=new c(a),this.events.push(d),d},d.prototype.on=function(a,b){this.suscribe(a,b)},d.prototype.suscribe=function(a,b){var c=this.getEvent(a);c&&c.suscribe(b)},d.prototype.unsuscribe=function(a,b){var c=this.getEvent(a);if(!a)for(var d in this.events)this.events[d].unsuscribe();else c&&c.unsuscribe(b)},d.prototype.fire=function(a,b){var c=this.getEvent(a);c&&c.fire(b)},a.EventTarget=d,d.extendObject(a),a.initEvents(),a.custom("canvasReady");var e=40,f=38,g=37,h=39,i=35,j=36,k=8,l=9,m=16,n=13,o=27,p=32,q=46,r=65,s=66,t=67,u=68,v=69,w=70,x=71,y=72,z=73,A=74,B=75,C=76,D=77,E=78,F=79,G=80,H=81,I=82,J=83,K=84,L=85,M=86,N=87,O=88,P=89,Q=90,R=112,S=113,T=114,U=115,V=116,W=117,X=118,Y=119,Z=48,$=49,_=50,ba=51,bb=52,bc=53,bd=54,be=55,bf=56,bg=57}(WCP),function(a){function b(){this.styles={},this.options={strokeStyle:"Black",fillStyle:"White",lineWidth:1},this.ctx=a.ctx;var b=function(b){return function(){b.ctx=a.ctx}}(this);a.on("canvasReady",b)}"use strict",b.prototype.setContext=function(a){this.ctx=a},b.prototype.draw=function(a){var b;a?this.styles[a]?b=this.styles[a]:a instanceof Object&&(b=a):b=this.options;for(var c in this.options)b[c]||(b[c]=this.options[c]);this.ctx.lineWidth=b.lineWidth,this.ctx.strokeStyle=b.strokeStyle,this.ctx.fillStyle=b.fillStyle,this.ctx.fill(),this.ctx.stroke()},b.prototype.defaultStyle=function(a){for(var b in this.options)a[b]===undefined&&(a[b]=this.options[b]);this.options=a},b.prototype.newStyle=function(){return{}},b.prototype.addStyle=function(a,b){b!==undefined&&(this.styles[b]=a)},b.prototype.removeStyle=function(a){return this.styles[a]?(this.styles[a]=0,!0):!1},b.prototype.newPolygon=function(){return{array:[],length:0,add:function(a,b){var c={x:a,y:b};this.array[this.length++]=c}}},b.prototype.point=function(a,b,c,d){return new this.Point(a,b,c,d)},b.prototype.Point=function(a,b,c,d){this.x=a,this.y=b,this.size=c,this.color=d},b.prototype.Point.prototype.draw=function(){this.size||(this.size=1),a.Draw.ctx.save(),this.color&&(a.Draw.ctx.fillStyle=this.color),a.Draw.ctx.fillRect(this.x-(this.size/2>=1?this.size/2:0),this.y-(this.size/2>=1?this.size/2:0),this.size,this.size),a.Draw.ctx.restore()},b.prototype.line=function(a,b,c,d,e){return new this.Line(a,b,c,d,e)},b.prototype.Line=function(a,b,c,d,e){this.x1=a,this.y1=b,this.x2=c,this.y2=d,this.style=e},b.prototype.Line.prototype.draw=function(){a.Draw.ctx.save(),a.Draw.ctx.beginPath(),a.Draw.ctx.moveTo(this.x1,this.y1),a.Draw.ctx.lineTo(this.x2,this.y2),a.Draw.ctx.closePath(),a.Draw.draw(this.style),a.Draw.ctx.restore()},b.prototype.circle=function(a,b,c,d){return new this.Circle(a,b,c,d)},b.prototype.Circle=function(a,b,c,d){this.x=a,this.y=b,this.radius=c,this.style=d},b.prototype.Circle.prototype.draw=function(){a.Draw.ctx.save(),a.Draw.ctx.beginPath(),a.Draw.ctx.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),a.Draw.ctx.closePath(),a.Draw.draw(this.style),a.Draw.ctx.restore()},b.prototype.ellipse=function(a,b,c,d,e){return new this.Ellipse(a,b,c,d,e)},b.prototype.Ellipse=function(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.style=e},b.prototype.Ellipse.prototype.draw=function(){a.Draw.ctx.save(),a.Draw.ctx.beginPath(),a.Draw.ctx.moveTo(this.x,this.y-this.height/2),a.Draw.ctx.bezierCurveTo(this.x+this.width/2,this.y-this.height/2,this.x+this.width/2,this.y+this.height/2,this.x,this.y+this.height/2),a.Draw.ctx.bezierCurveTo(this.x-this.width/2,this.y+this.height/2,this.x-this.width/2,this.y-this.height/2,this.x,this.y-this.height/2),a.Draw.ctx.closePath(),a.Draw.draw(this.style),a.Draw.ctx.restore()},b.prototype.Rect=function(a,b,c,d,e){return new this.Rect(a,b,c,d,e)},b.prototype.Rect=function(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.style=e},b.prototype.Rect.prototype.draw=function(){a.Draw.ctx.save(),a.Draw.ctx.beginPath(),a.Draw.ctx.moveTo(this.x,this.y),a.Draw.ctx.lineTo(this.x+this.width,this.y),a.Draw.ctx.lineTo(this.x+this.width,this.y+this.height),a.Draw.ctx.lineTo(this.x,this.y+this.height),a.Draw.ctx.lineTo(this.x,this.y),a.Draw.ctx.closePath(),a.Draw.draw(this.style),a.Draw.ctx.restore()},b.prototype.polygon=function(a,b){return new this.Polygon(a,b)},b.prototype.Polygon=function(a,b){a.array!==undefined?a.array instanceof Array&&(this.points=a.array):this.points=a},b.prototype.Polygon.prototype.draw=function(){if(this.points instanceof Array){a.Draw.ctx.save(),a.Draw.ctx.beginPath();var b=this.points();b.reverse();var c=b.pop();a.Draw.ctx.moveTo(c.x,c.y);while(b.length>0){var d=b.pop();d&&a.Draw.ctx.lineTo(d.x,d.y)}a.Draw.ctx.lineTo(c.x,c.y),a.Draw.ctx.closePath(),a.Draw.draw(this.style),a.Draw.ctx.restore()}},b.prototype.quadraCurve=function(a,b,c,d,e,f,g){return new this.QuadraCurve(a,b,c,d,e,f,g)},b.prototype.QuadraCurve=function(a,b,c,d,e,f,g){this.x1=a,this.y1=b,this.cpx=c,this.cpy=d,this.x2=e,this.y2=f,this.style=g},b.prototype.QuadraCurve.prototype.draw=function(){a.Draw.ctx.save(),a.Draw.ctx.beginPath(),a.Draw.ctx.moveTo(this.x1,this.y1),a.Draw.ctx.quadraticCurveTo(this.cpx,this.cpy,this.x2,this.y2),a.Draw.draw(this.style),a.Draw.ctx.restore()},b.prototype.bezierCurve=function(a,b,c,d,e,f,g,h,i){return new this.BezierCurve(a,b,c,d,e,f,g,h,i)},b.prototype.BezierCurve=function(a,b,c,d,e,f,g,h,i){this.x1=a,this.y1=b,this.cpx1=c,this.cpy1=d,this.cpx2=e,this.cp2y=f,this.x2=g,this.y2=h,this.style=i},b.prototype.BezierCurve.prototype.draw=function(){a.Draw.ctx.save(),a.Draw.ctx.beginPath(),a.Draw.ctx.moveTo(this.x1,this.y1),a.Draw.ctx.bezierCurveTo(this.cpx1,this.cpy1,this.cpx2,this.cpy2,this.x2,this.y2),a.Draw.draw(this.style),a.Draw.ctx.restore()},a.Draw=new b}(WCP),function(a){function d(){b[c]=this,this.animateId=c,c++,this.timeLine=[],this.time=0,this.stop=!1,this.speed=1,this.startTime=-1}function e(){this.clip=this,this.list=[],this.index=0,this.speed=1,this.stop=!1}function f(a,d){b[c]=this,this.animateId=c,c++,this.sprite=a,this.isSpriteAdd=!1,this.soundManager=d,this.bundles=[],this.curBundle=0,this.lastBundle=-1,this.spriteOrigin=null,this.startTime=-1,this.frameNumber=0,this.time=0}function g(a,b,c,d,e,f,g){var h=(a+c)/2,i=(b+d)/2,j=i-b,k=a-h,l=Math.sqrt(j*j+k*k),m=0;if(k===0)j>0?m=-Math.PI/2:m=Math.PI/2;else{var n=Math.atan(j/Math.abs(k));k>0?m=n:m=Math.PI-n}var o=0;g?o=1*f*e*Math.PI:o=-1*f*e*Math.PI;var p=m+o,q={};return q.x=Math.floor(h+l*Math.cos(p)),q.y=Math.floor(i+l*Math.sin(p)),q}"use strict";var b=[],c=0;d.prototype.add=function(a,b){if(this.timeLine.length===0)this.timeLine.push({time:a,object:b});else{var c=!1;for(var d in this.timeLine)if(a<=this.timeLine[d].time){this.timeLine.splice(d,0,{time:a,object:b}),c=!0;break}c===!1&&this.timeLine.push({time:a,object:b})}},d.prototype.start=function(){this.startTime<0&&(this.startTime=a.millitime(),this.step())},d.prototype.step=function(){if(this.stop===!1){while(this.timeLine.length>0&&this.timeLine[0].time<=this.time)typeof this.timeLine[0].object!="undefined"&&this.timeLine[0].object.start(),this.timeLine.shift();this.time=a.millitime()-this.startTime}a.setTimeout(0,function(a){return function(){a.step()}}(b[this.animateId]))},e.prototype.add=function(){for(var a=0;a<arguments.length;a++)this.list[this.index]=arguments[a],this.index++},e.prototype.start=function(){if(this.stop===!1)for(var a in this.list)var b=this.list[a].start()},e.prototype.clone=function(){var a=new e;for(var b in this.list)arguments.length>b?a.list[a.index]=this.list[b].clone(arguments[b]):a.list[a.index]=this.list[b].clone(),a.index++;return a.index=this.index,a.speed=this.speed,a.stop=this.stop,a},e.prototype.offset=function(a,b){for(var c in this.list)this.list[c].offset(a,b)},e.prototype.pause=function(){this.stop=!0},e.prototype.resume=function(){this.stop=!1},e.prototype.setSpeed=function(a){this.speed=a},f.prototype.animate=function(){return arguments.length>0&&this.addBundle(arguments),this},f.prototype.addBundle=function(a){var b=[];for(var c=0;c<a.length;c++){var d=this.createEffect(a[c]);b.push(d)}this.bundles.push(b)},f.prototype.createEffect=function(a){var b=0,c=j.NONE;return typeof a.frames!="undefined"?(b=a.frames,c=j.FRAMES):typeof a.time!="undefined"&&(b=a.time,c=j.TIME),a.properties={complete:!1,duration:b,durationType:c,shift:typeof a.shift!="undefined"?a.shift:h.line,ease:typeof a.ease!="undefined"?a.ease:i.none},delete a.duration,delete a.frames,delete a.time,a},f.prototype.start=function(){this.startTime<0&&(this.isSpriteAdd===!1&&(a.add(this.sprite),this.isSpriteAdd=!0),this.startTime=a.millitime(),this.step())},f.prototype.step=function(){if(this.bundles.length===0)return;if(this.curBundle>=this.bundles.length)return;this.frameNumber++;var c=!1;while(c===!1)this.curBundle<this.bundles.length&&this.stepBundle()===!0||(c=!0);a.setTimeout(0,function(a){return function(){a.step()}}(b[this.animateId]))},f.prototype.stepBundle=function(){if(this.curBundle!==this.lastBundle){this.spriteOrigin!==null&&delete this.spriteOrigin,this.spriteOrigin=[];for(var b in this.sprite)this.sprite.hasOwnProperty(b)&&(this.spriteOrigin[b]=this.sprite[b]);this.startTime=a.millitime(),this.lastBundle=this.curBundle}var c=!0,d=this.bundles[this.curBundle];if(d.length>0)for(var e=0;e<d.length;e++){this.time=a.millitime()-this.startTime;var f=d[e];typeof f.properties=="undefined"&&console.log(this.bundles,this.curBundle,d,d[e]),f.properties.complete===!1&&(this.stepEffect(f),c=!1),f.properties.next===!0&&(c=!0)}return c===!0&&this.curBundle++,c},f.prototype.getDelta=function(a){var b=1,c=!0;if(a.properties.durationType!==j.NONE&&a.properties.duration>0){var d=0;a.properties.durationType===j.FRAMES?d=this.frameNumber:a.properties.durationType===j.TIME&&(d=this.time),d>a.properties.duration?(b=1,c=!0):(b=a.properties.ease.calculate(d/a.properties.duration),c=!1)}return{percent:b,finish:c}},f.prototype.stepEffect=function(b){if(typeof b.animation!="undefined")b.animation.start(),b.properties.complete=!0;else if(typeof b.remove!="undefined")this.sprite.position(-1e3,-1e3),a.remove(this.sprite),this.isSpriteAdd=!0,b.properties.complete=!0;else if(typeof b.execute!="undefined")b.execute(),b.properties.complete=!0;else if(typeof b.sound!="undefined")console.log(b.sound),this.soundManager.get(b.sound).play(),b.properties.complete=!0;else if(typeof b.repeat!="undefined"){if(b.repeat!==0)for(var c=0;c<this.bundles.length;c++)for(var d=0;d<this.bundles[c].length;d++)this.bundles[c][d].properties.complete=!1,this.bundles[c][d].properties.next=!1;b.repeat>0?(this.curBundle=-1,this.startTime=0,b.repeat--):b.repeat<0&&(this.curBundle=-1,this.startTime=0),b.properties.complete=b.repeat===0?!0:!1,b.properties.next=!0}else{var e=this.getDelta(b);for(var f in b)b.hasOwnProperty(f)&&f!=="properties"&&f!=="x"&&f!=="y"&&(this.sprite[f]=this.spriteOrigin[f]+e.percent*(b[f]-this.spriteOrigin[f]));var g=typeof b.x!="undefined"?b.x:this.spriteOrigin.x,h=typeof b.y!="undefined"?b.y:this.spriteOrigin.y;if(g!==this.spriteOrigin.x||h!==this.spriteOrigin.y){var i=b.properties.shift.calculate(this.spriteOrigin.x,this.spriteOrigin.y,g,h,e.percent);this.sprite.x=i.x,this.sprite.y=i.y}e.finish===!0&&(b.properties.complete=!0)}},f.prototype.move=function(a,b){var c=[];return c.push({x:a,y:b}),this.addBundle(c),this},f.prototype.setSlice=function(a,b,c,d){var e=[];return e.push({sliceX:a,sliceY:b,width:c,height:d,sliceWidth:c,sliceHeight:d}),this.addBundle(e),this},f.prototype.wait=function(a){var b=[];return b.push({frames:a}),this.addBundle(b),this},f.prototype.waitTime=function(a){var b=[];return b.push({time:a}),this.addBundle(b),this},f.prototype.remove=function(){var a=[];a.push({remove:!0}),this.addBundle(a)},f.prototype.repeat=function(a){var b=[];return b.push({repeat:typeof a!="undefined"?a:-1}),this.addBundle(b),this},f.prototype.startAnimation=function(a){var b=[];return b.push({animation:a}),this.addBundle(b),this},f.prototype.execute=function(a){var b=[];return b.push({execute:a}),this.addBundle(b),this},f.prototype.sound=function(a){var b=[];return b.push({sound:a}),this.addBundle(b),this},f.prototype.pauseSound=function(a){var b=[];return b.push({playSound:a}),this.addBundle(b),this},f.prototype.clean=function(){this.bundles=[],this.curBundle=0,this.lastBundle=-1,this.spriteOrigin=null,this.startTime=-1,this.time=0},f.prototype.offset=function(a,b){this.sprite.x+=a,this.sprite.y+=b;for(var c in this.bundles)for(var d in this.bundles[c])typeof this.bundles[c][d].x!="undefined"&&(this.bundles[c][d].x+=a),typeof this.bundles[c][d].y!="undefined"&&(this.bundles[c][d].y+=b)},f.prototype.clone=function(b){a.add(b);var c=new f(b);for(var d in this)this.hasOwnProperty(d)&&d!=="animateId"&&d!=="bundles"&&d!=="sprite"&&(c[d]=this[d]);for(var e in this.bundles){var g=[];for(var h in this.bundles[e]){var i={};for(var j in this.bundles[e][h])if(j==="properties"){var k={};for(var l in this.bundles[e][h][j])k[l]=this.bundles[e][h][j][l];i[j]=k}else i[j]=this.bundles[e][h][j];g.push(i)}c.bundles.push(g)}return c};var h={line:{calculate:function(a,b,c,d,e){var f={};return f.x=a+e*(c-a),f.y=b+e*(d-b),f}},circle:{calculate:function(a,b,c,d,e){return g(a,b,c,d,e,1,2)}},circleReverse:{calculate:function(a,b,c,d,e){return g(a,b,c,d,e,-1,2)}},semiCircle:{calculate:function(a,b,c,d,e){return g(a,b,c,d,e,1,1)}},semiCircleReverse:{calculate:function(a,b,c,d,e){return g(a,b,c,d,e,-1,1)}}},i={none:{calculate:function(a){return a}},parabolic:{calculate:function(a){return a*a}},parabolicReverse:{calculate:function(a){return 1-(a-1)*(a-1)}}},j={NONE:1,FRAMES:2,TIME:3};a.Clip=e,a.TimeLine=d,a.Animation=f,a.Ease=i,a.Shift=h}(WCP),function(a){function b(){this.assetsCollection={},this.assetsCount=0,this.assetsLoaded=0,this.callbackLoadProgress=null,this.callbackLoadComplete=null}b.prototype.add=function(a,b){var c=this;if(typeof a!="object"){var e=b.substr(b.length-4).toLowerCase();if(e==".jpg"||e==".png"||e==".svg"||e==".gif"){var f=new Image;return f.loadFromSrc=b,f.loaded=!1,f.loading=!1,f.type=e,f.onload=function(){c.imageLoaded(f)},this.assetsCollection[a]=f,this.assetsCount++,f}if(e==".ogg"||e==".mp3"){var f=new Audio(b);return f.loadFromSrc=b,f.type=e,f.load(),this.assetsCollection[a]=f,this.assetsCount++,this.assetsLoaded++,f}console.log("Error type file(s) loading");return}for(var d in a)this.add(d,a[d])},b.prototype.loadAll=function(){for(var a in this.assetsCollection){var b=this.assetsCollection[a];!b.loaded&&!b.loading&&(b.src=b.loadFromSrc,b.loading=!0)}},b.prototype.get=function(a){return this.assetsCollection[a]},b.prototype.size=function(){return this.assetsCount},b.prototype.imageLoaded=function(a){this.assetsLoaded++,a.loaded=!0,a.loading=!1,this.callbackLoadProgress&&this.callbackLoadProgress.apply(null,[this,a,this.assetsLoaded,this.assetsCount]),this.assetsLoaded==this.assetsCount&&this.callbackLoadComplete&&this.callbackLoadComplete.apply(null,[this])},b.prototype.onLoadProgress=function(a){this.callbackLoadProgress=a},b.prototype.onLoadComplete=function(a){this.callbackLoadComplete=a},a.Assets=new b}(WCP),function(a){function b(a,b){typeof a=="object"?this.sound=a:(this.sound=new Audio,this.sound.src=a),this.sound.volume=.5,this.param(b)}function c(a,c){this.sounds=[],this.audio=a,this.params=c,this.sounds.push(new b(a,c)),this.clonable=!1,this.setLimit(10)}function d(){this.sounds=[]}"use strict",b.prototype.param=function(a){var b;for(b in a)b==="volume"?this.sound[b]=a[b]/100:this.sound[b]=a[b]},b.prototype.play=function(){this.sound.play()},b.prototype.pause=function(){this.sound.pause()},b.prototype.paused=function(){return this.sound.paused||this.sound.currentTime===0||this.sound.currentTime===this.sound.duration},b.prototype.togglePlay=function(){this.sound.paused||this.sound.currentTime===0?this.sound.play():this.sound.pause()},b.prototype.mute=function(){this.sound.muted=!0},b.prototype.unmute=function(){this.sound.muted=!1},b.prototype.toggleMute=function(){this.sound.muted?this.unmute():this.mute()},b.prototype.muted=function(){return this.sound.muted},b.prototype.volume=function(a){return a&&(a>100&&(a=100),a<0&&(a=0),this.sound.volume=a/100),this.sound.volume*100},b.prototype.duration=function(a){return this.sound.duration},b.prototype.time=function(a){return a>=0&&(this.sound.currentTime=a),this.sound.currentTime},b.prototype.rearward=function(a){this.sound.currentTime-=a||1,this.sound.currentTime<=0&&(this.sound.currentTime=0,this.sound.play())},b.prototype.forward=function(a){this.sound.currentTime+=a||1},c.prototype.setLimit=function(a){this.limit=a;while(this.sounds.length<this.limit)this.clone()},c.prototype.getNew=function(){return new b(this.audio.src,this.params)},c.prototype.clone=function(){this.sounds.push(this.getNew())},c.prototype.play=function(){var a;for(a=0;a<this.sounds.length-1;a++){this.sounds[a].time()===this.sounds[a].duration()&&this.sounds[a].time(0);if(this.sounds[a].paused()){this.sounds[a].play();return}}},c.prototype.pause=function(){},d.prototype.sound=function(a,c){var d=new b(a,c);return c.id?this.sounds[c.id]=d:d.src&&(this.sounds[d.src]=d),d},d.prototype.channel=function(a,b){var d=new c(a,b);return b.id?this.sounds[b.id]=d:d.src&&(this.sounds[d.src]=d),d},d.prototype.get=function(a){var b;for(b in this.sounds)if(b===a)return this.sounds[b]},d.prototype.shutDown=function(){var a;for(a in this.sounds)this.sounds[a].pause()},a.SoundManager=d}(WCP),function(a,b,c){function e(a){var b=c.createElement("span");c.body.appendChild(b),b.setAttribute("id","spanBuffer"),d=c.getElementById("spanBuffer"),d.style.font=a.weight+" "+a.size+"px "+a.font;var e=c.createTextNode(a.text);b.appendChild(e);var f=d.offsetHeight,g=d.offsetWidth,h=0,i=0;return c.body.removeChild(d),{height:f,width:g,descent:h,ascent:i}}function f(b,c){a.ctx.save(),a.ctx.rotate(a.Tools.degresToRadian(c.rotation)),a.ctx.textBaseline=c.baseline,a.ctx.fillStyle=c.color,a.ctx.font=c.weight+" "+c.size+"px "+c.font,a.ctx.fillText(b,c.x,c.y),a.ctx.restore()}function g(b,c,d,f,g){return this.id=a.random(10,99999),typeof b=="object"?(this.txt=b.text||"",this.x=b.x||0,this.y=b.y||0,this.width=b.maxwidth||a.canvas.width,this.color=b.color||"#333333",this.rotation=b.rotation||0,this.baseline=b.baseline||"top",this.font=b.font||"sans-serif",this.size=b.size||12,this.weight=b.weight||"normal",this.wordwarp=b.wordwarp||!0):(this.txt=b||"",this.x=c||0,this.y=d||this.y,this.width=f||a.canvas.width,this.color=g||a.ctx.fillStyle,this.rotation=0,this.baseline="top",this.font="sans-serif",this.size=12,this.weight="normal",this.wordwarp=!0),this.metrics=e(this),this}"use strict";var d;g.prototype.draw=function(){if(this.txt!==""){var b=a.ctx.measureText(this.txt).width;if(b+this.x>this.width&&this.wordwarp){var c=this.txt.split(" "),d="";for(var e=0;e<c.length;e++){var g=d+c[e]+" ",h=a.ctx.measureText(g).width;h>this.width-this.x?(f(d,this),d=c[e]+" ",this.y+=this.metrics.height):d=g}f(d,this)}else f(this.txt,this)}},g.prototype.setFont=function(a,b,c){return arguments.lenght!==0&&(this.size=b||this.size,this.weight=c||this.weight,this.font=a),this.weight+" "+this.size+"px "+this.font},g.prototype.setSize=function(a){return arguments.lenght!==0&&(this.size=a,this.metrics=e(this)),this.size},g.prototype.setColor=function(b){return arguments.lenght!==0&&(this.color=b),a.ctx.fillStyle},g.prototype.setText=function(a){return arguments.lenght!==0&&(this.txt=a,this.metrics=e(this)),this.txt},g.prototype.setBaseline=function(a){return arguments.lenght!==0&&(this.baseline=a),this.baseline},a.Text=g}(WCP,window,document),function(a){function b(){}"use strict",b.blur=function(a,b){return this.applyFilter(a,"blur",b)},b.brightness=function(a,b){return this.applyFilter(a,"brightness",b)},b.colorAdjust=function(a,b){return this.applyFilter(a,"colorAdjust",b[0],b[1],b[2])},b.contrast=function(a,b){return this.applyFilter(a,"contrast",b)},b.grayscale=function(a){return this.applyFilter(a,"grayscale")},b.hue=function(a,b){return this.applyFilter(a,"hue",b)},b.invert=function(a){return this.applyFilter(a,"invert")},b.lightness=function(a,b){return this.applyFilter(a,"lightness",b)},b.mosaic=function(a,b){return this.applyFilter(a,"mosaic",b)},b.saturation=function(a,b){return this.applyFilter(a,"saturation",b)},b.sepia=function(a){return this.applyFilter(a,"sepia")},b.solarize=function(a){return this.applyFilter(a,"solarize")},b.threshold=function(a,b){return this.applyFilter(a,"threshold",b)},b.filter=function(a,b,c){return this.applyFilter(a,c[0],c[1],c[2],c[3])},b.applyFilter=function(b,c,d,e,f){if(!b)return a.log("filter: Unable to apply a filter on an inexisting object"),null;var g=a.bufferCanvas(b.width,b.height);b instanceof a.Sprite?g.ctx.drawImage(b.img,b.sliceX,b.sliceY,b.sliceWidth,b.sliceHeight,0,0,b.width,b.height):b instanceof Image&&g.ctx.drawImage(b,0,0,b.width,b.height);var h=this.filterApplyFilter(g.ctx,b,c,d,e,f);return g.ctx.putImageData(h,0,0),g},b.filterApplyFilter=function(a,b,c,d,e,f){var g={blur:this.filterApplyBlur,brightness:this.filterApplyBrightness,colorAdjust:this.filterApplyColorAdjust,contrast:this.filterApplyContrast,grayscale:this.filterApplyGrayscale,hue:this.filterApplyHueOrSaturation,invert:this.filterApplyInvert,lightness:this.filterApplyLightness,mosaic:this.filterApplyMosaic,saturation:this.filterApplyHueOrSaturation,sepia:this.filterApplySepia,solarize:this.filterApplySolarize,threshold:this.filterApplyThreshold},h=a.getImageData(0,0,b.width,b.height);return c==="hue"?e=0:c==="saturation"&&(e=d,d=0),c==="colorAdjust"&&typeof e=="undefined"&&typeof f=="undefined"&&(e=d[1],f=d[2],d=d[0]),g[c]&&g[c](h.data,h.width,h.height,d,e,f),h},b.filterApplyBlur=function(a,b,c,d){d=Math.max(1,d);var e=a;for(var f=0;f<d;f++){for(var g=0;g<b;g++)for(var h=0;h<c;h++){var i=(g+(h-1)*b)*4,j=a[i],k=a[i+1],l=a[i+2],m=(g-1+h*b)*4,n=a[m],o=a[m+1],p=a[m+2],q=(g+h*b)*4,r=a[q],s=a[q+1],t=a[q+2],u=(g+1+h*b)*4,v=a[u],w=a[u+1],x=a[u+2],y=(g+(h+1)*b)*4,z=a[y],A=a[y+1],B=a[y+2];h-1<0&&(j=a[q],k=a[q+1],l=a[q+2]),g-1<0&&(n=a[q],o=a[q+1],p=a[q+2]),g+1>=b&&(v=a[q],w=a[q+1],x=a[q+2]),h+1>=c&&(z=a[q],A=a[q+1],B=a[q+2]),e[q]=(j+n+r*2+v+z)/6,e[q+1]=(k+o+s*2+w+A)/6,e[q+2]=(l+p+t*2+x+B)/6}a=e}},b.filterApplyBrightness=function(a,b,c,d){d=Math.max(-150,Math.min(150,d))*100/150;for(var e=0;e<b;e++)for(var f=0;f<c;f++){var g=(e+f*b)*4,h=a[g],i=a[g+1],j=a[g+2];a[g]=Math.round(h*(1+d/100)),a[g+1]=Math.round(i*(1+d/100)),a[g+2]=Math.round(j*(1+d/100))}},b.filterApplyColorAdjust=function(a,b,c,d,e,f){d=Math.round(Math.max(0,Math.min(255,d))-255),e=Math.round(Math.max(0,Math.min(255,e))-255),f=Math.round(Math.max(0,Math.min(255,f))-255);for(var g=0;g<b;g++)for(var h=0;h<c;h++){var i=(g+h*b)*4,j=a[i]+d,k=a[i+1]+e,l=a[i+2]+f;j>255?a[i]=255:j<0?a[i]=0:a[i]=j,k>255?a[i+1]=255:k<0?a[i+1]=0:a[i+1]=k,l>255?a[i+2]=255:l<0?a[i+2]=0:a[i+2]=l}},b.filterApplyContrast=function(a,b,c,d){d=Math.max(-1,d);for(var e=0;e<b;e++)for(var f=0;f<c;f++){var g=(e+f*b)*4,h=a[g],i=a[g+1],j=a[g+2];a[g]=Math.round(h+d*(h-127)),a[g+1]=Math.round(i+d*(i-127)),a[g+2]=Math.round(j+d*(j-127))}},b.filterApplyGrayscale=function(a,b,c){for(var d=0;d<b;d++)for(var e=0;e<c;e++){var f=(d+e*b)*4,g=a[f],h=a[f+1],i=a[f+2],j=.3*g+.59*h+.11*i;a[f]=j,a[f+1]=j,a[f+2]=j}},b.filterApplyHueOrSaturation=function(a,b,c,d,e){d=Math.max(-180,Math.min(180,d)),d=d%360/360;var f=d*6;e=Math.max(-100,Math.min(100,e))/100,e<0?e++:e=e*2+1;for(var g=0;g<b;g++)for(var h=0;h<c;h++){var i=(g+h*b)*4,j=a[i],k=a[i+1],l=a[i+2],m=j;k>m&&(m=k),l>m&&(m=l);var n=j;k<n&&(n=k),l<n&&(n=l);var o=m-n,p=(n+m)/510;if(p>0&&o>0){var q=0,r=0,s=0;p<=.5?(q=o/(m+n)*e,q>1&&(q=1),r=p*(1+q)):(q=o/(510-m-n)*e,q>1&&(q=1),r=p+q-p*q),j===m?k===n?s=5+(m-l)/o+f:s=1-(m-k)/o+f:k===m?l===n?s=1+(m-j)/o+f:s=3-(m-l)/o+f:j===n?s=3+(m-k)/o+f:s=5-(m-j)/o+f,s<0&&(s+=6),s>=6&&(s-=6);var t=p+p-r,u=s>>0;u===0?(j=r*255,k=(t+(r-t)*(s-u))*255,l=t*255):u===1?(j=(r-(r-t)*(s-u))*255,k=r*255,l=t*255):u===2?(j=t*255,k=r*255,l=(t+(r-t)*(s-u))*255):u===3?(j=t*255,k=(r-(r-t)*(s-u))*255,l=r*255):u===4?(j=(t+(r-t)*(s-u))*255,k=t*255,l=r*255):u===5&&(j=r*255,k=t*255,l=(r-(r-t)*(s-u))*255)}j>255?a[i]=255:j<0?a[i]=0:a[i]=j,k>255?a[i+1]=255:k<0?a[i+1]=0:a[i+1]=k,l>255?a[i+2]=255:l<0?a[i+2]=0:a[i+2]=l}},b.filterApplyInvert=function(a,b,c){for(var d=0;d<b;d++)for(var e=0;e<c;e++){var f=(d+e*b)*4;a[f]=255-a[f],a[f+1]=255-a[f+1],a[f+2]=255-a[f+2]}},b.filterApplyLightness=function(a,b,c,d){d=Math.max(-100,Math.min(100,d))/100;for(var e=0;e<b;e++)for(var f=0;f<c;f++){var g=(e+f*b)*4,h=a[g],i=a[g+1],j=a[g+2];d<0?(h*=d+1,i*=d+1,j*=d+1):d>0&&(h=h*(1-d)+d*255,i=i*(1-d)+d*255,j=j*(1-d)+d*255),h>255?a[g]=255:h<0?a[g]=0:a[g]=h,i>255?a[g+1]=255:i<0?a[g+1]=0:a[g+1]=i,j>255?a[g+2]=255:j<0?a[g+2]=0:a[g+2]=j}},b.filterApplyMosaic=function(a,b,c,d){d=Math.max(2,d);for(var e=0;e<b;e+=d)for(var f=0;f<c;f+=d){var g=(e+f*b)*4,h=a[g],i=a[g+1],j=a[g+2],k=d,l=d;k+e>b&&(k=b-e),l+f>c&&(l=c-f);for(var m=e;m<e+k;m++)for(var n=f;n<f+l;n++){var o=(m+n*b)*4;a[o]=h,a[o+1]=i,a[o+2]=j}}},b.filterApplySepia=function(a,b,c){for(var d=0;d<b;d++)for(var e=0;e<c;e++){var f=(d+e*b)*4,g=a[f],h=a[f+1],i=a[f+2],j=g*.393+h*.769+i*.189,k=g*.349+h*.686+i*.168,l=g*.272+h*.534+i*.131;j>255?a[f]=255:j<0?a[f]=0:a[f]=j,k>255?a[f+1]=255:k<0?a[f+1]=0:a[f+1]=k,l>255?a[f+2]=255:l<0?a[f+2]=0:a[f+2]=l}},b.filterApplySolarize=function(a,b,c){for(var d=0;d<b;d++)for(var e=0;e<c;e++){var f=(d+e*b)*4,g=a[f],h=a[f+1],i=a[f+2];g>127&&(g=255-g),h>127&&(h=255-h),i>127&&(i=255-i),a[f]=g,a[f+1]=h,a[f+2]=i}},b.filterApplyThreshold=function(a,b,c,d){d=Math.max(0,Math.min(254,d));for(var e=0;e<b;e++)for(var f=0;f<c;f++){var g=(e+f*b)*4,h=a[g],i=a[g+1],j=a[g+2],k=0;.2126*h+.7152*i+.0722*j>=d&&(k=255),a[g]=k,a[g+1]=k,a[g+2]=k}},b.AQUA=[0,255,255],b.BLACK=[0,0,0],b.BLUE=[0,0,255],b.FUCHSIA=[255,0,255],b.GRAY=[128,128,128],b.GREEN=[0,128,0],b.LIME=[0,255,0],b.MAROON=[128,0,0],b.NAVY=[0,0,128],b.OLIVE=[128,128,0],b.PURPLE=[128,0,128],b.RED=[255,0,0],b.SILVER=[192,192,192],b.TEAL=[0,128,128],b.WHITE=[255,255,255],b.YELLOW=[255,255,0],a.Filter=b}(WCP),function(a){function b(b){if(b.length<2)return a.log("length too short"),null;for(var c=1;c<b.length;c++)if(b[0].length!==b[c].length)return a.log("Bad format"),null;this.matrix=b,this.line=b.length,this.column=b[0].length,this.line===this.column?this.square=this.line:this.square=null}function c(a){if(a.length<2)return null;var c=[];for(var d=0;d<a.length;d++){c[d]=[];for(var e=0;e<a.length;e++)c[d][e]=d===e?a[d]:0}var f=new b(c);return f}function d(a){if(a<2)return null;var b=[];for(var d=0;d<a;d++)b[d]=1;var e=new c(b);return e}function e(a){var c=new b([[Math.cos(a),-Math.sin(a)],[Math.sin(a),Math.cos(a)]]);return c}function f(a){var c=new b([[1,0,0],[0,Math.cos(a),-Math.sin(a)],[0,Math.sin(a),Math.cos(a)]]);return c}function g(a){var c=new b([[Math.cos(a),0,Math.sin(a)],[0,1,0],[-Math.sin(a),0,Math.cos(a)]]);return c}function h(a){var c=new b([[Math.cos(a),-Math.sin(a),0],[Math.sin(a),Math.cos(a),0],[0,0,1]]);return c}function i(a,c){var d=[];for(var e=0;e<a;e++){d[e]=[];for(var f=0;f<c;f++)d[e][f]=0}var g=new b(d);return g}"use strict",b.prototype.add=function(a){if(this.column!==a.column||this.line!==a.line)return null;var b=this.cpy();for(var c=0;c<this.line;c++)for(var d=0;d<this.column;d++)b.matrix[c][d]=b.matrix[c][d]+a.matrix[c][d];return b},b.prototype.at=function(a,b){return this.matrix[a][b]},b.prototype.cpy=function(){var a=[];for(var c=0;c<this.line;c++){a[c]=[];for(var d=0;d<this.column;d++)a[c][d]=this.at(c,d)}var e=new b(a);return e},b.prototype.determinant=function(a){if(this.square===!1)return null;arguments.length===0&&(a=this.column);var b=0,c=new i(3,3);if(a===2)b=this.matrix[0][0]*this.matrix[1][1]-this.matrix[1][0]*this.matrix[0][1];else for(var d=0;d<a;d++){for(var e=1;e<a;e++){var f=0;for(var g=0;g<a;g++)g!==d&&(c.matrix[e-1][f]=this.matrix[e][g],f++)}b=b+Math.pow(-1,d)*this.matrix[0][d]*c.determinant(a-1)}return b},b.prototype.isSameSizeAs=function(a){return this.line===a.line&&this.column===a.column?!0:!1},b.prototype.mult=function(a){if(a instanceof b){var c=[];for(var d=0;d<this.line;d++){c[d]=[];for(var e=0;e<this.line;e++){var f=0;for(var g=0;g<this.column;g++)f+=this.at(d,g)*a.at(g,e);c[d][e]=f}}var h=new b(c);return h}},b.prototype.round=function(){var a=[];for(var c=0;c<this.line;c++){a[c]=[];for(var d=0;d<this.column;d++)a[c][d]=Math.round(this.at(c,d))}var e=new b(a);return e},b.prototype.show=function(b){arguments.length===1?a.log("/-- "+b+" ---"):a.log("/----------");for(var c=0;c<this.column;c++)console.log("["+this.matrix[c].toString()+"]");arguments.length===1?a.log("--- "+b+" --\\"):a.log("----------\\")},b.prototype.sub=function(a){if(this.column!==a.column||this.line!==a.line)return null;var b=this.cpy();for(var c=0;c<this.line;c++)for(var d=0;d<this.column;d++)b.matrix[c][d]=b.matrix[c][d]-a.matrix[c][d];return b},a.Matrix=b,a.MatrixDiagonal=c,a.MatrixIdentity=d,a.MatrixRotation=e,a.MatrixRotationX=f,a.MatrixRotationY=g,a.MatrixRotationZ=h,a.MatrixZero=i}(WCP),function(a){function c(b){this.refresh=b.refreshRate||1e3/60,this.lastUpdate=0,this.active=!1,this.paused=!1,this.sched=new a.TimeScheduler,this.children=[],this.fn={init:b.init||function(){},loop:b.loop||function(){},draw:b.draw||function(){},destroy:b.destroy||function(){}}}function d(){for(var a=0;a<b.activeViews.length;a++)b.activeViews[a].stop()}function e(b){b=b<1?1:b>60?60:b,console.log(b),a.globalFps=b}function f(){return a.globalFps}function g(){return a.fpsCounter.get()}function h(a,c){return c?function(){b.updatingView&&b.updatingView[c][a].apply(b.updatingView[c],arguments)}:function(){b.updatingView&&b.updatingView[a].apply(b.updatingView,arguments)}}function i(){window.requestAnimFrame(i);var c=a.millitime();if(c-b.lastGlobalUpdateTime<1e3/a.globalFps)return;b.lastGlobalUpdateTime=c;var d=!1;for(var e=0,f=b.activeViews.length;e<f;e++){var g=b.activeViews[e];g.lastUpdate===0&&(g.lastUpdate=b.lastGlobalUpdateTime),d||(a.clear(),a.fpsCounter.tick(),d=!0),g.active===!0?g.update():g.paused&&g.draw(),g.lastUpdate=b.lastGlobalUpdateTime}}"use strict",window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}();var b={activeViews:[],updatingView:null,lastGlobalUpdateTime:0};a.globalFps=60,a.fpsCounter=new a.TimeCounter,c.prototype.update=function(){this.active&&(b.updatingView=this,this.sched.update(),this.fn.loop.call(this),this.draw(),b.updatingView=null)},c.prototype.draw=function(b){b=b||a.ctx;for(var c in this.children)if(this.children.hasOwnProperty(c)){var d=this.children[c];for(var e=0,f=d.length;e<f;e++)d[e].draw(b)}this.fn.draw.call(this)},c.prototype.start=function(a){this.active||(this.active=!0,b.activeViews.push(this),b.updatingView=this,this.fn.init.call(this,a),b.updatingView=null)},c.prototype.stop=function(){this.active&&(b.updatingView=this,this.fn.destroy.call(this),b.updatingView=null,this.active=!1,this.paused=!1,this.lastUpdate=0,_viewData.activeViews.splice(b.activeViews.indexOf(this),1),this.children=[],this.sched.reset())},c.prototype.pause=function(){!this.paused&&this.active&&(this.paused=!0,this.active=!1,this.sched.unpause())},c.prototype.unpause=function(){this.paused&&(this.paused=!1,this.active=!0,this.sched.unpause())},c.prototype._notifyZIndexChange=function(a,b,c){if(a._parent!=this)return;this.children[c]||(this.children[c]=[]);var d=this.children[b].indexOf(a);this.children[b].splice(d,1),this.children[c].push(a)},c.prototype.add=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=b._zindex;!b._parent!=this&&(this.children[c]||(this.children[c]=[]),this.children[c].push(b),b._parent&&b._parent.remove(b),b._parent=this)}},c.prototype.remove=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=b._zindex;if(b._parent==this&&this.children[c]){var d=this.children[c].indexOf(b);this.children[c].splice(d,1),b._parent=null}}},c.prototype.elapsed=function(){return b.lastGlobalUpdateTime-this.lastUpdate},a.View=c,a.clearViews=d,a.setFps=e,a.getFps=f,a.getRealFps=g,a.add=h("add"),a.remove=h("remove"),a.setTimeout=h("setTimeout","sched"),a.clearTimeout=h("clearTimeout","sched"),a.setInterval=h("setInterval","sched"),a.clearInterval=h("clearInterval","sched"),a.initViewModule=function(){a.fpsCounter.reset(),i()}}(WCP);