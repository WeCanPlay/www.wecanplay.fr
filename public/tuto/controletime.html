<?php
    $title = 'Controle the time';
    $base_url = '../';
    $page = 'documentation';
    require('../header.php');
?>

<div class="container">
    <div class="jumbotron subhead">
        <h1>Controle the time</h1>
    </div>

    <div class="row">
        <div class="span3">
        <div class="well sidebar-nav">
            <ul class="nav nav-list">
                <li><a href="/tuto/intro.html">Introduction</a></li>
<li><a href="/tuto/basichtml.html">Html Structure</a></li>
<li><a href="/tuto/initialise.html">Initialise WCP</a></li>
<li><a href="/tuto/firstview.html">Create our first view</a></li>
<li><a href="/tuto/loadasset.html">Use Assets</a></li>
<li><a href="/tuto/handleevenent.html">event</a></li>
<li><a href="/tuto/movethesnake.html">asdas</a></li>
<li><a href="/tuto/controletime.html">Controle the time</a></li>
<li><a href="/tuto/eatgrow.html">Eat & grow</a></li>
<li><a href="/tuto/finish.html">finish</a></li>
            </ul>
            </div><!--/.well -->
        </div><!--/span-->
        <div class="span8 well doc">
            <h2>Time Controle</h2>
<p>Well, the snake move pretty fast. We will modify this.

</p>
<p>Firstly, just create one constant.

</p>
<pre><code class="lang-JavaScript">SPEED = 80;</code></pre>
<p>An other variable will be necessary.

</p>
<pre><code class="lang-JavaScript">var refresh;</code></pre>
<p>Initialise it with the current time in milliseconds added to the speed.

</p>
<pre><code class="lang-JavaScript">refresh = WCP.millitime() + SPEED;</code></pre>
<p>This define the next time of the move.

</p>
<p>We need to check the next move inside the loop and set the next time for the move.

</p>
<pre><code class="lang-JavaScript">if (WCP.millitime() &gt;= refresh) {
    move();
    refresh = WCP.millitime() + SPEED;
}</code></pre>
<p>We have this code now:

</p>
<pre><code class="lang-Html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Snake&lt;/title&gt;
        &lt;style&gt;
            #canvas {
                border : 1px solid black;
            }
        &lt;/style&gt;
        &lt;script src=&#39;WCP-0.3.js&#39; type=&#39;text/javascript&#39;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;canvas id=&quot;canvas&quot;&gt;&lt;/canvas&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            CANVAS_WIDTH = 200;
            CANVAS_HEIGHT = 200;
            SPEED = 80;
            WCP.setCanvas(&#39;canvas&#39;, CANVAS_WIDTH, CANVAS_HEIGHT);
            var snake;
            var apple;
            var size;
            var headSprite;
            var appleSprite;
            var direction;
            var refresh;
            WCP.Assets.add({
                path: &#39;ressources/&#39;,
                assets: {
                    &#39;head&#39;  : &#39;head.png&#39;,
                    &#39;body&#39;  : &#39;body.png&#39;,
                    &#39;apple&#39; : &#39;apple.png&#39;,
                }
            });
            WCP.Assets.load();
            var game = {
                init: function () {
                    snake = {x: 50, y: 50};
                    apple = {x: 100, y: 100};
                    size = 10;
                    headSprite = new WCP.SliceSprite(WCP.Assets.get(&#39;head&#39;), snake.x, snake.y, size, size);
                    appleSprite = new WCP.SliceSprite(WCP.Assets.get(&#39;apple&#39;), snake.x, snake.y, size, size);
                    direction = &#39;RIGHT&#39;;
                    refresh = WCP.millitime() + SPEED;

                    WCP.listen();
                    WCP.keydown(&#39;up&#39;, changeDirection);
                    WCP.keydown(&#39;down&#39;, changeDirection);
                    WCP.keydown(&#39;left&#39;, changeDirection);
                    WCP.keydown(&#39;right&#39;, changeDirection);
                },
                loop: function () {
                    if (WCP.millitime() &gt;= refresh) {
                        move();
                        refresh = WCP.millitime() + SPEED;
                    }
                },
                draw: function () {
                    WCP.clear();
                    headSprite.position(snake.x, snake.y);
                    headSprite.draw();
                    appleSprite.position(apple.x, apple.y);
                    appleSprite.draw();                },
                destroy: function () {
                }
            };
            var gameView = new WCP.View(game);
            gameView.start();

            function changeDirection(event) {
                if (event.which === 37) {
                    if (direction !== &#39;RIGHT&#39;) {
                        direction = &#39;LEFT&#39;;
                    }
                }
                else if (event.which === 38) {
                    if (direction !== &#39;DOWN&#39;) {
                        direction = &#39;UP&#39;;
                    }
                }
                else if (event.which === 39) {
                    if (direction !== &#39;LEFT&#39;) {
                        direction = &#39;RIGHT&#39;;
                    }
                }
                else if (event.which === 40) {
                    if (direction !== &#39;UP&#39;) {
                        direction = &#39;DOWN&#39;;
                    }
                }
            }
            function move() {
                if (direction === &#39;UP&#39;) {
                    if ((snake.y - size) &gt;= 0) {
                        snake.y -= size;
                    }
                    else {
                        snake.y = CANVAS_HEIGHT - size;
                    }
                }
                else if (direction === &#39;DOWN&#39;) {
                    if ((snake.y + size) &lt; CANVAS_HEIGHT) {
                        snake.y += size;
                    }
                    else {
                        snake.y = 0;
                    }
                }
                else if (direction === &#39;LEFT&#39;) {
                    if ((snake.x - size) &gt;= 0) {
                        snake.x -= size;
                    }
                    else {
                        snake.x = CANVAS_WIDTH - size;
                    }
                }
                else if (direction === &#39;RIGHT&#39;) {
                    if ((snake.x + size) &lt; CANVAS_WIDTH) {
                        snake.x += size
                    }
                    else {
                        snake.x = 0;
                    }
                }
            }
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>

        </div>
    </div>
    <hr class="soften">
    <footer>
        <p>EIP - WeCanPlay  2012</p>
    </footer>
</div> <!-- /container -->
<?php
    require('../footer.php');
?>
