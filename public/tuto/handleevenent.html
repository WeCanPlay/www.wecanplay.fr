<?php
    $title = 'event';
    $base_url = '../';
    $page = 'documentation';
    require('../header.php');
?>

<div class="container">
    <div class="jumbotron subhead">
        <h1>event</h1>
    </div>

    <div class="row">
        <div class="span3">
        <div class="well sidebar-nav">
            <ul class="nav nav-list">
                <li><a href="/tuto/intro.html">Introduction</a></li>
<li><a href="/tuto/basichtml.html">Html Structure</a></li>
<li><a href="/tuto/initialise.html">Initialise WCP</a></li>
<li><a href="/tuto/firstview.html">Create our first view</a></li>
<li><a href="/tuto/loadasset.html">Use Assets</a></li>
<li><a href="/tuto/handleevenent.html">event</a></li>
<li><a href="/tuto/movethesnake.html">asdas</a></li>
<li><a href="/tuto/controletime.html">Controle the time</a></li>
<li><a href="/tuto/eatgrow.html">Eat & grow</a></li>
<li><a href="/tuto/finish.html">finish</a></li>
            </ul>
            </div><!--/.well -->
        </div><!--/span-->
        <div class="span8 well doc">
            <h2>Handle events</h2>
<p>To know where the snake must go, we need to catch the event that are fired when the player press down a key.

</p>
<p>Firstly, we say to WCP in the init function that the framework must listen the event triggered.

</p>
<pre><code class="lang-JavaScript">WCP.listen();</code></pre>
<p>To save the direction, we create a variable.

</p>
<pre><code class="lang-JavaScript">var direction;</code></pre>
<p>That we initialise.

</p>
<pre><code class="lang-JavaScript">direction = &#39;RIGHT&#39;;</code></pre>
<p>We create a function that will analyse the triggered event.
We check the check element inside the parameter to know which key was pressed down.

</p>
<pre><code class="lang-JavaScript">function changeDirection(event) {
    if (event.which === 37) {
        direction = &#39;LEFT&#39;;
    }
    else if (event.which === 38) {
        direction = &#39;UP&#39;;
    }
    else if (event.which === 39) {
        direction = &#39;RIGHT&#39;;
    }
    else if (event.which === 40) {
        direction = &#39;DOWN&#39;;
    }
}</code></pre>
<p>Now, for each key possible in the snake game (up, down, left, right) we associate a callback function, that we name changeDirection, for them.

</p>
<pre><code class="lang-JavaScript">WCP.keydown(&#39;up&#39;, changeDirection);
WCP.keydown(&#39;down&#39;, changeDirection);
WCP.keydown(&#39;left&#39;, changeDirection);
WCP.keydown(&#39;right&#39;, changeDirection);</code></pre>
<p>To prevent bugs, we allow to change the direction only if the new direction is not the opposite of the current one.

</p>
<pre><code class="lang-JavaScript">function changeDirection(event) {
    if (event.which === 37) {
        if (direction !== &#39;RIGHT&#39;) {
            direction = &#39;LEFT&#39;;
        }
    }
    else if (event.which === 38) {
        if (direction !== &#39;DOWN&#39;) {
            direction = &#39;UP&#39;;
        }
    }
    else if (event.which === 39) {
        if (direction !== &#39;LEFT&#39;) {
            direction = &#39;RIGHT&#39;;
        }
    }
    else if (event.which === 40) {
        if (direction !== &#39;UP&#39;) {
            direction = &#39;DOWN&#39;;
        }
    }
}</code></pre>
<p>At this point, we have this:

</p>
<pre><code class="lang-Html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Snake&lt;/title&gt;
        &lt;style&gt;
            #canvas {
                border : 1px solid black;
            }
        &lt;/style&gt;
        &lt;script src=&#39;WCP-0.3.js&#39; type=&#39;text/javascript&#39;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;canvas id=&quot;canvas&quot;&gt;&lt;/canvas&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            CANVAS_WIDTH = 200;
            CANVAS_HEIGHT = 200;
            WCP.setCanvas(&#39;canvas&#39;, CANVAS_WIDTH, CANVAS_HEIGHT);
            var snake;
            var apple;
            var size;
            var headSprite;
            var bodySprite;
            var appleSprite;
            var direction;
            WCP.Assets.add({
                path: &#39;ressources/&#39;,
                assets: {
                    &#39;head&#39;  : &#39;head.png&#39;,
                    &#39;body&#39;  : &#39;body.png&#39;,
                    &#39;apple&#39; : &#39;apple.png&#39;,
                }
            });
            WCP.Assets.load();
            var game = {
                init: function () {
                    snake = {x: 50, y: 50};
                    apple = {x: 100, y: 100};
                    size = 10;
                    headSprite = new WCP.SliceSprite(WCP.Assets.get(&#39;head&#39;), snake.x, snake.y, size, size);
                    appleSprite = new WCP.SliceSprite(WCP.Assets.get(&#39;apple&#39;), snake.x, snake.y, size, size);
                    direction = &#39;RIGHT&#39;;

                    WCP.listen();
                    WCP.keydown(&#39;up&#39;, changeDirection);
                    WCP.keydown(&#39;down&#39;, changeDirection);
                    WCP.keydown(&#39;left&#39;, changeDirection);
                    WCP.keydown(&#39;right&#39;, changeDirection);
                },
                loop: function () {
                },
                draw: function () {
                    WCP.clear();
                    headSprite.position(snake.x, snake.y);
                    headSprite.draw();
                    appleSprite.position(apple.x, apple.y);
                    appleSprite.draw();
                },
                destroy: function () {
                }
            };
            var gameView = new WCP.View(game);
            gameView.start();

            function changeDirection(event) {
                if (event.which === 37) {
                    if (direction !== &#39;RIGHT&#39;) {
                        direction = &#39;LEFT&#39;;
                    }
                }
                else if (event.which === 38) {
                    if (direction !== &#39;DOWN&#39;) {
                        direction = &#39;UP&#39;;
                    }
                }
                else if (event.which === 39) {
                    if (direction !== &#39;LEFT&#39;) {
                        direction = &#39;RIGHT&#39;;
                    }
                }
                else if (event.which === 40) {
                    if (direction !== &#39;UP&#39;) {
                        direction = &#39;DOWN&#39;;
                    }
                }
            }
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>

        </div>
    </div>
    <hr class="soften">
    <footer>
        <p>EIP - WeCanPlay  2012</p>
    </footer>
</div> <!-- /container -->
<?php
    require('../footer.php');
?>
