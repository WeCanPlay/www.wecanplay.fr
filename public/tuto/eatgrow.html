<?php
    $title = 'Eat & grow';
    $base_url = '../';
    $page = 'documentation';
    require('../header.php');
?>

<div class="container">
    <div class="jumbotron subhead">
        <h1>Eat & grow</h1>
    </div>

    <div class="row">
        <div class="span3">
        <div class="well sidebar-nav">
            <ul class="nav nav-list">
                <li><a href="/tuto/intro.html">Introduction</a></li>
<li><a href="/tuto/basichtml.html">Html Structure</a></li>
<li><a href="/tuto/initialise.html">Initialise WCP</a></li>
<li><a href="/tuto/firstview.html">firstview</a></li>
<li><a href="/tuto/loadasset.html">asset</a></li>
<li><a href="/tuto/handleevenent.html">event</a></li>
<li><a href="/tuto/movethesnake.html">asdas</a></li>
<li><a href="/tuto/controletime.html">Controle the time</a></li>
<li><a href="/tuto/eatgrow.html">Eat & grow</a></li>
<li><a href="/tuto/finish.html">finish</a></li>
            </ul>
            </div><!--/.well -->
        </div><!--/span-->
        <div class="span8 well doc">
            <h2>Eat &amp; grow</h2>
<p>Our snake is ridiculously small and need some strength. We are going to teach him how to eat to became bigger.

</p>
<p>When the snake is at the same position of an apple, he eats it. In a new function, cleverly named eat, we add the code to check the position of our objects.

</p>
<pre><code class="lang-JavaScript">function eat() {
    if (snake.x === apple.x &amp;&amp; snake.y === apple.y) {
    }
}</code></pre>
<p>This function need to be call at each move, to see if the snake is on the same place as the apple.

</p>
<pre><code class="lang-JavaScript">loop: function () {
    if (WCP.millitime() &gt;= refresh) {
        move();
        eat();
        refresh = WCP.millitime() + SPEED;
    }
}</code></pre>
<p>After eating the apple, our snake grows. We need a new variable, named body.

</p>
<pre><code class="lang-JavaScript">var body;</code></pre>
<p>That we initialise as an array.

</p>
<pre><code class="lang-JavaScript">body = new Array();</code></pre>
<p>When the apple is eaten, we add a new part in the body.
The part is an array with the coordinates of the snake.

</p>
<pre><code class="lang-JavaScript">body.push({x: snake.x, y: snake.y});</code></pre>
<p>To see the body, we need to modify the draw function.
We just print as many square as the body have.
But we first need to create the body&#39;s sprite.

</p>
<pre><code class="lang-JavaScript">var bodySprite;</code></pre>
<pre><code class="lang-JavaScript">bodySprite = new WCP.SliceSprite(WCP.Assets.get(&#39;body&#39;), snake.x, snake.y, size, size);</code></pre>
<pre><code class="lang-JavaScript">for (var n = 0; n &lt; body.length; n++) {
    bodySprite.position(body[n].x, body[n].y);
    bodySprite.draw();
}</code></pre>
<p>The parts of the body need to move with the snake.
To do so, we will take the last part of the body, modify its coordinates with the snake position (just before its move) and put it back in the begining of the array.
We add this code in the begining of the move function.

</p>
<pre><code class="lang-JavaScript">if (body.length &gt; 0) {
    var part = body.pop();
    part.x = snake.x;
    part.y = snake.y;
    body.unshift(part);
}</code></pre>
<p>Well, if the apple does not change place at each eat, the game will be very simple.
That is why we add few lines when the apple is eaten.

</p>
<pre><code class="lang-Html">apple.x = Math.floor(Math.random() * (CANVAS_WIDTH / size)) * size;
apple.y = Math.floor(Math.random() * (CANVAS_HEIGHT / size)) * size;</code></pre>
<p>To prevent an apple that pop on the snake and its body, we need to check this.
If it is the case we need to find an other coordinates.

</p>
<pre><code class="lang-JavaScript">var stop = false;
while (stop === false) {
    apple.x = Math.floor(Math.random() * (CANVAS_WIDTH / size)) * size;
    apple.y = Math.floor(Math.random() * (CANVAS_HEIGHT / size)) * size;
    stop = true;
    if (snake.x === apple.x &amp;&amp; snake.y === apple.y) {
        stop = false;
    }
    else {
        for (var n = 0; n &lt; body.length; n++) {
            if (body[n].x === apple.x &amp;&amp; body[n].y === apple.y) {
                stop = false;
                break ;
            }
        }
    }
}</code></pre>
<p>We&#39;ve got this now:
</p>
<pre><code class="lang-Html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Snake&lt;/title&gt;
        &lt;style&gt;
            #canvas {
                border : 1px solid black;
            }
        &lt;/style&gt;
        &lt;script src=&#39;WCP-0.3.js&#39; type=&#39;text/javascript&#39;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;canvas id=&quot;canvas&quot;&gt;&lt;/canvas&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            CANVAS_WIDTH = 200;
            CANVAS_HEIGHT = 200;
            SPEED = 80;
            WCP.setCanvas(&#39;canvas&#39;, CANVAS_WIDTH, CANVAS_HEIGHT);
            var snake;
            var apple;
            var size;
            var headSprite;
            var bodySprite;
            var appleSprite;
            var direction;
            var refresh;
            var body;
            WCP.Assets.add({
                path: &#39;ressources/&#39;,
                assets: {
                    &#39;head&#39;  : &#39;head.png&#39;,
                    &#39;body&#39;  : &#39;body.png&#39;,
                    &#39;apple&#39; : &#39;apple.png&#39;,
                }
            });
            WCP.Assets.load();
            var game = {
                init: function () {
                    snake = {x: 50, y: 50};
                    apple = {x: 100, y: 100};
                    size = 10;
                    headSprite = new WCP.SliceSprite(WCP.Assets.get(&#39;head&#39;), snake.x, snake.y, size, size);
                    bodySprite = new WCP.SliceSprite(WCP.Assets.get(&#39;body&#39;), snake.x, snake.y, size, size);
                    appleSprite = new WCP.SliceSprite(WCP.Assets.get(&#39;apple&#39;), snake.x, snake.y, size, size);
                    direction = &#39;RIGHT&#39;;
                    refresh = WCP.millitime() + SPEED;
                    body = new Array();

                    WCP.listen();
                    WCP.keydown(&#39;up&#39;, changeDirection);
                    WCP.keydown(&#39;down&#39;, changeDirection);
                    WCP.keydown(&#39;left&#39;, changeDirection);
                    WCP.keydown(&#39;right&#39;, changeDirection);
                },
                loop: function () {
                    if (WCP.millitime() &gt;= refresh) {
                        move();
                        eat();
                        refresh = WCP.millitime() + SPEED;
                    }
                },
                draw: function () {
                    WCP.clear();
                    for (var n = 0; n &lt; body.length; n++) {
                        bodySprite.position(body[n].x, body[n].y);
                        bodySprite.draw();
                    }
                    headSprite.position(snake.x, snake.y);
                    headSprite.draw();
                    appleSprite.position(apple.x, apple.y);
                    appleSprite.draw();
                },
                destroy: function () {
                }
            };
            var gameView = new WCP.View(game);
            gameView.start();

            function changeDirection(event) {
                if (event.which === 37) {
                    if (direction !== &#39;RIGHT&#39;) {
                        direction = &#39;LEFT&#39;;
                    }
                }
                else if (event.which === 38) {
                    if (direction !== &#39;DOWN&#39;) {
                        direction = &#39;UP&#39;;
                    }
                }
                else if (event.which === 39) {
                    if (direction !== &#39;LEFT&#39;) {
                        direction = &#39;RIGHT&#39;;
                    }
                }
                else if (event.which === 40) {
                    if (direction !== &#39;UP&#39;) {
                        direction = &#39;DOWN&#39;;
                    }
                }
            }
            function move() {
                if (body.length &gt; 0) {
                    var part = body.pop();
                    part.x = snake.x;
                    part.y = snake.y;
                    body.unshift(part);
                }
                if (direction === &#39;UP&#39;) {
                    if ((snake.y - size) &gt;= 0) {
                        snake.y -= size;
                    }
                    else {
                        snake.y = CANVAS_HEIGHT - size;
                    }
                }
                else if (direction === &#39;DOWN&#39;) {
                    if ((snake.y + size) &lt; CANVAS_HEIGHT) {
                        snake.y += size;
                    }
                    else {
                        snake.y = 0;
                    }
                }
                else if (direction === &#39;LEFT&#39;) {
                    if ((snake.x - size) &gt;= 0) {
                        snake.x -= size;
                    }
                    else {
                        snake.x = CANVAS_WIDTH - size;
                    }
                }
                else if (direction === &#39;RIGHT&#39;) {
                    if ((snake.x + size) &lt; CANVAS_WIDTH) {
                        snake.x += size
                    }
                    else {
                        snake.x = 0;
                    }
                }
            }
            function eat() {
                if (snake.x === apple.x &amp;&amp; snake.y === apple.y) {
                    body.push({x: apple.x, y: apple.y});
                    var stop = false;
                    while (stop === false) {
                        apple.x = Math.floor(Math.random() * (CANVAS_WIDTH / size)) * size;
                        apple.y = Math.floor(Math.random() * (CANVAS_HEIGHT / size)) * size;
                        stop = true;
                        if (snake.x === apple.x &amp;&amp; snake.y === apple.y) {
                            stop = false;
                        }
                        else {
                            for (var n = 0; n &lt; body.length; n++) {
                                if (body[n].x === apple.x &amp;&amp; body[n].y === apple.y) {
                                    stop = false;
                                    break ;
                                }
                            }
                        }
                    }
                }
            }
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>

        </div>
    </div>
    <hr class="soften">
    <footer>
        <p>EIP - WeCanPlay  2012</p>
    </footer>
</div> <!-- /container -->
<?php
    require('../footer.php');
?>
