<?php
    $title = 'finish';
    $base_url = '../';
    $page = 'documentation';
    require('../header.php');
?>

<div class="container">
    <div class="jumbotron subhead">
        <h1>finish</h1>
    </div>

    <div class="row">
        <div class="span3">
        <div class="well sidebar-nav">
            <ul class="nav nav-list">
                <li><a href="/tuto/intro.html">Introduction</a></li>
<li><a href="/tuto/basichtml.html">Html Structure</a></li>
<li><a href="/tuto/initialise.html">Initialise WCP</a></li>
<li><a href="/tuto/firstview.html">Create our first view</a></li>
<li><a href="/tuto/loadasset.html">Use Assets</a></li>
<li><a href="/tuto/handleevenent.html">event</a></li>
<li><a href="/tuto/movethesnake.html">asdas</a></li>
<li><a href="/tuto/controletime.html">Controle the time</a></li>
<li><a href="/tuto/eatgrow.html">Eat & grow</a></li>
<li><a href="/tuto/finish.html">finish</a></li>
            </ul>
            </div><!--/.well -->
        </div><!--/span-->
        <div class="span8 well doc">
            <h1>Everything must end</h1>
<p>Our games looks good but the rules are not really respected.
If we touch the body with the snake, the game does not end.
We will are going to change this.

</p>
<p>We create a new function called collision.

</p>
<pre><code class="lang-JavaScript">function collision() {
}</code></pre>
<p>In this one, we explore the body to check if the snake does not touch one of these parts.
If the snake touch one, we stop the view.

</p>
<pre><code class="lang-JavaScript">for (var n = 0; n &lt; body.length; n++) {
    if (snake.x === body[n].x &amp;&amp; snake.y === body[n].y) {
        gameView.stop();
    }
}</code></pre>
<p>At the end, this is our code:

</p>
<pre><code class="lang-Html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Snake&lt;/title&gt;
        &lt;style&gt;
            #canvas {
                border : 1px solid black;
            }
        &lt;/style&gt;
        &lt;script src=&#39;WCP-0.3.js&#39; type=&#39;text/javascript&#39;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;canvas id=&quot;canvas&quot;&gt;&lt;/canvas&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            CANVAS_WIDTH = 200;
            CANVAS_HEIGHT = 200;
            SPEED = 80;
            WCP.setCanvas(&#39;canvas&#39;, CANVAS_WIDTH, CANVAS_HEIGHT);
            var snake;
            var apple;
            var size;
            var headSprite;
            var bodySprite;
            var appleSprite;
            var direction;
            var refresh;
            var body;
            WCP.Assets.add({
                path: &#39;ressources/&#39;,
                assets: {
                    &#39;head&#39;  : &#39;head.png&#39;,
                    &#39;body&#39;  : &#39;body.png&#39;,
                    &#39;apple&#39; : &#39;apple.png&#39;,
                    //&#39;music&#39; : &#39;music.ogg&#39;,
                    //&#39;eat&#39;   : &#39;eat.ogg&#39;
                }
            });
            WCP.Assets.load();
            var game = {
                init: function () {
                    snake = {x: 50, y: 50};
                    apple = {x: 100, y: 100};
                    size = 10;
                    headSprite = new WCP.SliceSprite(WCP.Assets.get(&#39;head&#39;), snake.x, snake.y, size, size);
                    bodySprite = new WCP.SliceSprite(WCP.Assets.get(&#39;body&#39;), snake.x, snake.y, size, size);
                    appleSprite = new WCP.SliceSprite(WCP.Assets.get(&#39;apple&#39;), snake.x, snake.y, size, size);
                    direction = &#39;RIGHT&#39;;
                    refresh = WCP.millitime() + SPEED;
                    body = new Array();

                    WCP.listen();
                    WCP.keydown(&#39;up&#39;, changeDirection);
                    WCP.keydown(&#39;down&#39;, changeDirection);
                    WCP.keydown(&#39;left&#39;, changeDirection);
                    WCP.keydown(&#39;right&#39;, changeDirection);
                },
                loop: function () {
                    if (WCP.millitime() &gt;= refresh) {
                        move();
                        collision();
                        eat();
                        refresh = WCP.millitime() + SPEED;
                    }
                },
                draw: function () {
                    WCP.clear();
                    for (var n = 0; n &lt; body.length; n++) {
                        bodySprite.position(body[n].x, body[n].y);
                        bodySprite.draw();
                    }
                    headSprite.position(snake.x, snake.y);
                    headSprite.draw();
                    appleSprite.position(apple.x, apple.y);
                    appleSprite.draw();
                },
                destroy: function () {
                }
            };
            var gameView = new WCP.View(game);
            gameView.start();

            function changeDirection(event) {
                if (event.which === 37) {
                    if (direction !== &#39;RIGHT&#39;) {
                        direction = &#39;LEFT&#39;;
                    }
                }
                else if (event.which === 38) {
                    if (direction !== &#39;DOWN&#39;) {
                        direction = &#39;UP&#39;;
                    }
                }
                else if (event.which === 39) {
                    if (direction !== &#39;LEFT&#39;) {
                        direction = &#39;RIGHT&#39;;
                    }
                }
                else if (event.which === 40) {
                    if (direction !== &#39;UP&#39;) {
                        direction = &#39;DOWN&#39;;
                    }
                }
            }
            function move() {
                if (body.length &gt; 0) {
                    var part = body.pop();
                    part.x = snake.x;
                    part.y = snake.y;
                    body.unshift(part);
                }
                if (direction === &#39;UP&#39;) {
                    if ((snake.y - size) &gt;= 0) {
                        snake.y -= size;
                    }
                    else {
                        snake.y = CANVAS_HEIGHT - size;
                    }
                }
                else if (direction === &#39;DOWN&#39;) {
                    if ((snake.y + size) &lt; CANVAS_HEIGHT) {
                        snake.y += size;
                    }
                    else {
                        snake.y = 0;
                    }
                }
                else if (direction === &#39;LEFT&#39;) {
                    if ((snake.x - size) &gt;= 0) {
                        snake.x -= size;
                    }
                    else {
                        snake.x = CANVAS_WIDTH - size;
                    }
                }
                else if (direction === &#39;RIGHT&#39;) {
                    if ((snake.x + size) &lt; CANVAS_WIDTH) {
                        snake.x += size
                    }
                    else {
                        snake.x = 0;
                    }
                }
            }
            function eat() {
                if (snake.x === apple.x &amp;&amp; snake.y === apple.y) {
                    body.push({x: apple.x, y: apple.y});
                    var stop = false;
                    while (stop === false) {
                        apple.x = Math.floor(Math.random() * (CANVAS_WIDTH / size)) * size;
                        apple.y = Math.floor(Math.random() * (CANVAS_HEIGHT / size)) * size;
                        stop = true;
                        if (snake.x === apple.x &amp;&amp; snake.y === apple.y) {
                            stop = false;
                        }
                        else {
                            for (var n = 0; n &lt; body.length; n++) {
                                if (body[n].x === apple.x &amp;&amp; body[n].y === apple.y) {
                                    stop = false;
                                    break ;
                                }
                            }
                        }
                    }
                }
            }
            function collision() {
                for (var n = 0; n &lt; body.length; n++) {
                    if (snake.x === body[n].x &amp;&amp; snake.y === body[n].y) {
                        gameView.stop();
                    }
                }
            }
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>

        </div>
    </div>
    <hr class="soften">
    <footer>
        <p>EIP - WeCanPlay  2012</p>
    </footer>
</div> <!-- /container -->
<?php
    require('../footer.php');
?>
